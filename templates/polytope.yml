tools:
  add-agent-server:
    name: add-agent-server
    info: |
      Creates and starts a multi-agent FastAPI server that hosts all your agents in one service.
      Run this if asked to create a agents.
      This command creates the server code and automatically starts it running with hot reload.
      The tool resolve will contain detailed instructions on how to proceed.
      Creates the server in "agent-server" directory by default.
    await: [scaffold-agent-server]
    run:
      - id: scaffold-agent-server
        tool: polytope/scaffold
        args:
          actions:
            - template: {type: repo, repo: "#pt-clj pt/module-repo-ref", path: agent-server}
              path: agent-server
              on-conflict: skip
              add-to-tools: [{tool: default, call: agent-server}]
            - template: https://github.com/opper-ai/opperai-agent-sdk.git
              path: lib/py/opper-agent-sdk
              print-files: []
              on-conflict: skip
            - template: {type: repo, repo: "#pt-clj pt/module-repo-ref", path: agent-dashboard}
              path: agent-dashboard
              on-conflict: skip
              print-files: []
              add-to-tools: [{tool: default, call: agent-dashboard}]
      - id: agent-server
        after: {step: scaffold-agent-server}
        code: '#pt-clj (pt/call-module "agent-server" {}))'
      - id: agent-dashboard
        after: {step: scaffold-agent-server}
        code: '#pt-clj (pt/call-module "agent-dashboard" {})'
